---
title: "Course review, and some useful links"
output:
  pdf_document: default
urlcolor: blue
---

```{r, include=F}
library(patchwork)
library(RColorBrewer)
library(pals)
library(tidyverse)
data(iris)
plot_pal <- function(cols){
  pdata <- tibble(col = cols, x= seq(1, length(cols)), y=0)
  cv <- cols
  names(cv) <- cv
  plot <- ggplot(pdata) + 
    geom_tile(aes(x=x, y=y,fill = col), width = 1, height= .5) +
    scale_fill_manual(values=cv) +
    theme_void()+
    theme(legend.position = 'none')
  return(plot)
}
```
# Review 

This covers most of the material we have gone over through out this course 

## Base R

    In R, data is stored using variables. The assignment operator `<-` and the equals operator `=` can be used interchangably  for variable assignment 

```{r}
x=5
#or
x <- 5
```

### Data types

There are four main data types in R:
- `numeric`: any number based data, integers, decimals. EX. `5`, or `4.5`
- `character`: any textual data. Must be enclosed in `""` or `''`. EX. `"Hello"`
- `factor`: a method for representing character data in a memory efficient way. A mapping between unique characters and numbers is created, and only mapping + numerical representation end up being stored
- `logical`: Also known as `bools`, takes on two values - `TRUE` or `FALSE`. Generated by logical operators and used to control flow of code


### Data Structures

Data structures are containers for multiple variables. Commonly used data strictures in R
- Vector: a sequence of values; must be a single type. Attempting to create a vector with mixed data types leads to type coercion

```{r}
#ex
example_vector <- c(1, 2, 3, 4)
```

- List: a sequence of values or other objects. lists can store individual variables, vectors, other lists, or potentially any other data type you may encounter in R. 

```{r}
example_list <- list(x=c(1, 2,3, 5),
                     y='Hello')
```

- `data.frame`: a data structure for holding rectangular data made of rows and columns. Under the hood, can be considered a list of columns

```{r}
data.frame(x=c('a', 'b', 'c'),
           y=1, 2, 3)

```

### Indexing

- most major data structures provide a method for accessing specific elements stored inside them. This is called indexing
- generally each element in a data structure can be accessed by its numeric position within the data structure. See examples below for syntax

```{r}
## vector
x <- c(1,2, 3)
x[2]
```

```{r}
# list 
example_list <- list(x=c(1, 2,3, 5),
                     y='Hello')
example_list[[1]]
```

```{r}
## Data frames
## df[<rowindex>, <columnindex>]
df <- data.frame(x=c('a', 'b', 'c'),
           y=1, 2, 3)
df[2, 3]
```

### Functions 

Functions are re-usable pieces of code that are designed for performing a specific task. Functions can take an input, apply some code to it, and pass back an output. EX.

```{r}
get_length <- function(example_input){
  print(example_input)
  example_output <- length(example_input)
  return(example_output)
}
```

Variables are passed from outside the function inside via the input arguments and can be mapped explicitly using the syntax below. The `return` function passes information from inside the function back to the environment that called it.

```{r}
d <- c(1, 2,3)
get_length(example_input = d)
```


For a more comprehensive overview of base R, see the file `Intro-to-R/intro_to_R_slides.html` in the course folder

## Logical operations

We use logical operations to evaluate whether data meets certain conditions. Common logical operators are 

-  `<`, `>`: compares two numerical items. if expression is logical statement, returns true. EX

```{r}
5>3
```

```{r}
1>5
```

- `==`: equality operator: check whether two variables are exactly the same. EX:

```{r}
5==5
```

```{r}
5==4
```

- `!`: the not operator. Invert an existing logical variable 

```{r}
!TRUE
```

Logical operators can be use to generate logical vectors, which can be used to index and filter data 

```{r}
x <- c(1, 2, 3, 4, 5)
x[x>2]
```

For a more comprehensive overview of logical operations, see the file `Intro-to-R/conditional_programming_slides.html` in the course folder.

## Plotting with ggplot

### Overview

The `ggplot` library provides a plotting API that allows you to use the same syntax for a wide range of plots 

```{r}
ggplot(iris) + 
  geom_point(aes(x=Sepal.Width, y=Sepal.Length, color = Petal.Length)) + 
  theme_minimal()
```

A plot made with `ggplot` has three key layers

- base layer (`ggplot(...)` ): this function initializes a blank plot. both data and aesthetic mappings can be supplied through the `ggplot` function, but are set as the defaults for the rest of the plot. Input data must be a data.frame

- geom layer (`geom_...(...)`): draws a specific visualization, ie boxplot, scatter plot etc. Each distinct `geom_...` function has its own unique set of aesthetic parameters that can either be mapped with the `aes` function to columns in the input data, or set manually. Multiple geom layers can be added together to make complicated plots. Multiple dataset can be included and passed directly to geom layers instead of the base `ggplot()` layer

- theme layer (`theme_...(...)`): the `theme` functions exposes a variety of graphical parameters like axis labels or legend orientation. Several preset themes like `theme_minmal()` have parameters set to specific settings for easy use.

In order to save plots, use the `ggsave` function

```{r}
plot <- ggplot(iris) + 
  geom_point(aes(x=Sepal.Width, y=Sepal.Length, color = Petal.Length)) + 
  theme_minimal()

ggsave(filename = 'example.png', plot = plot, bg = 'white')
```


### Colors in R

A diverse range of colors are available to you in R. Packages like `pals` and `RColorBrewer` provide multiple color palettes.
Most data is either categorical or numeric; categorical data is composed of distinct units that are completely separate from each other. They are best represented by divergent color palettes

```{r}
plot_pal(pals::alphabet(26))
```

Continuous data is best represented by a gradient of three contrasting colors 

```{r}
plot_pal(pals::viridis(12))
```

### Modifying aesthetics

Generally, any aesthetic parameter that can be set within the `aes`(ie color, fill, size etc) function can be set with some `scale...` function

```{r}
ggplot(iris) + 
  geom_point(aes(x=Sepal.Width, y=Sepal.Length, color = Petal.Length)) + 
  scale_color_gradientn(colours = RColorBrewer::brewer.pal(12, 'YlOrRd'))+
  theme_minimal()
```

For a more information about plotting with `ggplot`, see the slides in the `Plotting-with-ggplot/` folder.

## Manipulating data with the `tidyverse`

The Tidyverse is a collection of packages that provide fast, easy to use functions for manipulating tabular data in R. To load them all, use

```{r}
library(tidyverse)
```

### `readr`

The `readr` library provides funtions for reading/writing data from/to the disk 

- reading

```{r}
sc_data <- read_tsv('../src/pbmc_cell_expression.tsv.gz')
head(sc_data)
```

- writing

```{r}
write_csv(sc_data, 'example.csv')
```

### dplyr

The `dplyr` library provides multiple functions for manipulating dataframe:

- `select`: select columns from a data.frame

```{r}
iris %>% select(Sepal.Width, Sepal.Length) %>% head
```

- `mutate`:  add or change a column

```{r}
iris %>% mutate(is_long_sepal = Sepal.Width >5) %>% head
```

- `rename`: change the name of a columns

```{r}
iris %>% rename(length_sepal = Sepal.Length) %>% head
```

- `arrange`: sort data by values in 1 or more columns

```{r}
iris %>% arrange(Species, Sepal.Length) %>% head
```

- `filter`: subset data based on logical operations

```{r}
iris %>% filter(Sepal.Length >5 ) %>% head
```

- `group_by` and `summarise`: group rows by unique values across multiple columns, and then perform a operations on each group.

```{r}
iris %>% 
  group_by(Species) %>% 
  summarise(avg_petal_length = mean(Petal.Length))
```

### `tidyr`

There's really only one function we covered from here - `pivot_longer`: convert data from wide to long format 

```{r}
iris %>% 
  pivot_longer(cols = -Species, names_to = 'measurement_type', values_to = 'measuerment_values')  %>% head
```

For more information about the `tidyverse` see the slides in `Using-the-tidyverse`

# Libraries used througout the course

[ComplexHeatmap](https://jokergoo.github.io/ComplexHeatmap-reference/book/)

- Non-ggplot based package for plotting Heatmaps. 
- Heatmaps are useful visualizations for showing subpopulations in clustered data
- Has extensive documentation and is extremely flexible. 

[ComplexUpset](https://github.com/krassowski/complex-upset)

- Non-ggplot based package for plotting upset plots 
- upset plots are useful for visualizing interactions between sets 

[DT](https://rstudio.github.io/DT/)

- Create interactive data tables in Rmarkdown and Shiny

[RColorBrewer](https://cran.r-project.org/web/packages/RColorBrewer/index.html) 

- create diverse color palettes for plots. Can generate both discrete and continuous palettes

[circlize](https://jokergoo.github.io/circlize_book/book/)

- Create circos plots and circular color scales 

[dplyr](https://dplyr.tidyverse.org)

- an *excellent* toolbox for cleaning and manipulating data

[flextable](https://davidgohel.github.io/flextable/)

- create precisely formatted tables when using Rmarkdown to generate `.docx` files 

[gapminder](https://cran.r-project.org/web/packages/gapminder/README.html)

- load the `gapminder` dataset as a `data.frame`, and contains information about population, life expectancy and GDP. 
- Use data set for testing out plots

[ggalluvial](https://cran.r-project.org/web/packages/ggalluvial/vignettes/ggalluvial.html)

- Generate Alluvial plots using ggplot syntax
- alluvial plots are useful for visualizing subsets in categorical data, or changes in composition of categorical data over time 

[gganimate](https://gganimate.com)

- Turn (almost) any ggplot into an animated figure. 

[gghalves](https://github.com/erocoar/gghalves)

- Plot half geoms(violin/boxplot/points)
- useful for showing changes between two similar conditions 

[ggiraph](https://davidgohel.github.io/ggiraph/articles/offcran/using_ggiraph.html)

- Uses ggplot syntax to add interactivity to plots by adding tooltip(show info when hovering mouse over position)
 
[ggpattern](https://github.com/coolbutuseless/ggpattern)

- Add shading patterns to ggplots

[ggplot2](https://ggplot2.tidyverse.org)

- The best plotting library in R. uses the Grammar of Graphic(gg) to define a concise syntax for generating plots 
- `ggplots` are composed of several key components
    - `ggplot(data)` : create a new blank plot
    - `geom_...` : add some sort of visualization(points, boxplots, etc), and
    - `aes()` : generate and aesthetic mapping between columns in `data` and visual aesthetics in `geom_...`
    - save plots using `ggplot::ggsave`

[ggplotify](https://github.com/GuangchuangYu/ggplotify)

- Convert any plot generated in R into a `ggplot` object. 
- This allows plots generated from non-ggplot based libraries to be merged with other plots through `patchwork`, or saved using `ggplot::ggsave`

[ggpubr](https://rpkgs.datanovia.com/ggpubr/)

- an alternative plotting package that provides simpler functions for generating plots, and provides functions for for may

[ggrepel](https://ggrepel.slowkow.com)

- generate text and labels on `ggplots` that *repel* from each other, so they don't crowd each other, or  other elements in the plot 

[ggridges](https://wilkelab.org/ggridges/)

- create ridge plots in `ggplot`. 
- ridge plots are useful for visualizing continuous distributions across many variables

[ggsci](https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html)

- provides alternative color palettes that are inspired by plots from different scientific journals

[ggspatial](https://github.com/paleolimbot/ggspatial)

- an extension to ggplot for plotting map data. 
- uses spatial data defined by the `sf` package

[ggthemes](https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/)

- a collection of themes and color palettes inspired by popular websites

[ggtree](https://github.com/YuLab-SMU/ggtree)

- an extension to `ggplot` for visualizing trees and dendrograms 

[kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html)
- An extension to `Rmarkdown` that allows you to better format tables 

[knitr](https://yihui.org/knitr/)

- the core library behind `Rmarkdown`
- use knitr to control `Rmarkdown` and create high-quality reports and documents with embedded code 

[maps](https://cran.r-project.org/web/packages/maps/maps.pdf)
- provides spatial info for common maps(world, USA, etc)

[pals](https://cran.r-project.org/web/packages/pals/vignettes/pals_examples.html)

- a comprehensive set of color palettes for R
- in my opinion, the best package for generating color palettes

[patchwork](https://patchwork.data-imaginist.com)
- a useful library for assembling multiple `ggplots` into a single figure
- combine plots with intuitive operators like `+`, `/` and , `|`, as well as specify custom layouts 

[plotly](https://plotly.com/r/)

- a  feature-rich library for making interactive visualizations that can be embedding in `Rmarkdown` reports or `shiny` apps 

[redoc](https://github.com/noamross/redoc)

- seamlessly(ish) move between Rmarkdown <==> Microsoft Word

[sf](https://r-spatial.github.io/sf/)

- a package for working with geospatial data in R

[shiny](https://shiny.rstudio.com)

- the core package for interactive visualizations in R. 
- Build fast and dynamic webapps that can be hosted locally or on a webserver

[tidyverse](https://www.tidyverse.org)

- an *amazing* collection of packages for data science in R. 
    - tibble: a new data type analogous to a `data.frame`, but with more consistent indexing, and no type coercion
    - dplyr: a series of functions for subsetting, filtering, changing, and summarizing dataframes/tibbles
    - tidyr: functions for tidying data(more on that later)
    -  stringr: library for efficiently working with strings
    - readr: efficiently read/write data
    - forcats: library for efficiently working with factors
    - purrr: adds common programming methods from other languages into
    - using `library(tidyverse)` makes it easy to load these all at once; but you can load them individually if you choose 


# Useful links

## Rstudio cheatsheets

Quick references for common packages. See more cheatsheets [here](https://rstudio.com/resources/cheatsheets/)

- [base R](http://github.com/rstudio/cheatsheets/raw/master/base-r.pdf) : tips and tricks for base R

- [dplyr](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf) : manipulating and tidying data

- [ggplot](https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf) : core plotting library 

- [shiny](https://github.com/rstudio/cheatsheets/raw/master/shiny.pdf) : interactive visualizations

- [Rmarkdown](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf) : creating notebooks and reports


